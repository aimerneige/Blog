# GCC

## GCC 简介

GCC 是 Linux 下的编译工具集，是 GNU Compiler Collection 的缩写,包含 gcc 、 g++ 等编译器。这个工具集不仅包含编译器，还包含其他工具集，例如 ar 、 nm 等。

GCC 工具集不仅能编译 C/C++ 语言，其他例如 Objective-C 、 Pascal 、 Fortran 、 Java 、 Ada 等语言均能进行编译。

GCC 在可以根据不同的硬件平台进行编译，即能进行交叉编译，在 A 平台上编译 B 平台的程序，支持常见的 X86 、 ARM 、 PowerPC 、 mips 等，以及 Linux 、 Windows 等软件平台。

GCC 的 C 编译器 是 gcc，其命令格式为 :

```bash
Usage: gcc [options] file...
```

GCC 下默认文扩展名的含义：

| 文件扩展名 | GCC 所理解的含义                    |
| ---------- | ----------------------------------- |
| \*.c       | 该类文件为 C 语言的源文件           |
| \*.h       | 该类文件为 C 语言的头文件           |
| \*.i       | 该类文件为预处理后的 C 文件         |
| \*.C       | 该类文件为 C++ 语言的源文件         |
| \*.cc      | 该类文件为 C++ 语言的源文件         |
| \*.cxx     | 该类文件为 C++ 语言的源文件         |
| \*.m       | 该类文件为 Objective-C 语言的源文件 |
| \*.s       | 该类文件为汇编语言的源文件          |
| \*.o       | 该类文件为汇编后的目标文件          |
| \*.a       | 该类文件为静态库                    |
| \*.so      | 该类文件为共享库                    |
| a.out      | 该类文件为链接后的输出文件          |

GCC 下有很多编译器，可以支持 C 语言，C++语言等多种语言

| GCC 编译器命令 | 含义                 |
| -------------- | -------------------- |
| cc             | 指的是 C 语言编译器  |
| cpp            | 指的是预处理编译器   |
| gcc            | 指的是 C 语言编译器  |
| g++            | 指的是 C++语言编译器 |

## 编译程序的基本知识

GCC 编译器对程序的编译分为 4 个阶段：

1. 预编译
2. 编译和优化
3. 汇编
4. 链接

GCC 的编译器可以将这 4 个步骤合并成一个。

源文件指存放可编辑代码的文件，如存放 C/C++ 和汇编语言的文件。

目标文件是指经过编译器的编译生成的 CPU 可识别的二进制代码，但是目标文件一般不能执行，因为其中的一些函数过程没有相关的指示和说明。

可执行文件就是目标文件与相关的库链接后的文件，它是可以执行的。

预编译过程将程序中引用的头文件包含进源代码中，并对一些宏进行替换。

编译过程将用户可识别的语言翻译成一组处理器可识别的操作码，生成目标文件，通常翻译成汇编语言，而汇编语言通常和机器操作码之间是一种一对一的关系。 GNU 中有 C/C++ 编译器 GCC 和汇编器 as。

所有的目标文件必须用某种方式组合起来才能运行，这就是链接的作用。目标文件中通常仅解析了文件内部的变量和函数，对于引用的函数和变量还没有解析，这需要将其他已经编写好的目标文件引用进来，将没有解析的变量和函数进行解析，通常引用的目标是库。链接完成后会生成可执行文件。

## 单个文件编译成执行文件

下面是一个示例程序的源代码：

```c
// hello.c
#include <stdio.h>

int main()
{
    printf("Hello World!\n");

    return 0;
}
```

将其保存在 `hello.c` 文件中，运行如下命令将代码直接编译成可执行文件：

```bash
$ gcc hello.c
```

上述命令没有指定生成执行文件的名称， GCC 将生成默认的文件名 `a.out`。 运行结果如下：

```bash
$ ./a.out
Hello World!
```

如果希望生成指定的可执行文件名，选项 `-o` 可以使编译程序生成指定文件名，例如将上述程序编译输出一个名称为 `test` 的执行程序：

```bash
$ gcc -o test hello.c
```

上述命令把 `hello.c` 源文件编译成可执行文件 `test`。 运行可执行文件 `test`，向终端输出 `"Hello World!"` 字符串。运行结果如下：

```bash
$ ./test
Hello World!
```

## 编译生成目标文件

GCC 的 `-c` 选项可以用于生成目标文件，这一选项将源文件生成目标文件，而不是生成可执行文件。默认情况下生成的目标文件的文件名和源文件的名称一样，只是扩展名为 `.o`。例如，下面的命令会生成一个名字为 Hello.o 的目标文件：

```bash
$ gcc -c hello.c
```

如果需要生成指定的文件名，可以使用 `-o` 选项。下面的命令将源文件 `hello.c` 编译成目标文件，文件名为 `test.o`：

```bash
$ gcc -c -o test.o hello.c
```

可以用一条命令编译多个源文件，生成目标文件，这通常用于编写库文件或者一个项目中包含多个源文件。例如一个项目包含 `filel.c` 、 `file2.c` 和 `file3.c`, 下面的命令可以将源文件生成 3 个目标文件 : `filel.o` 、 `file2.o` 和 `file3.o`：

```bash
$ gcc -c file1.c file2.c file3.c
```

## 多文件编译

GCC 可以自动链接多个文件，不管是目标文件还是源文件，都可以使用同一个命令编译到一个可执行文件中。例如一个项目包含俩个文件，文件 `string.c` 中有一个函数 `StrLen` 用于计算字符串的长度，而在 `main.c` 中调用这个函数将计算结果显示出来。

### 源文件 `string.c`

```c
// string.c
#define ENDSTRING '\0'
int StrLen(char *string)
{
    int len = 0;

    while (*string++ != ENDSTRING) {
        len++;
    }
    return len;
}
```

### 源文件 `main.c`

```c
// main.c
#include <stdio.h>
extern int StrLen(char *str);
int main()
{
    char src[] = "Hello AimerNeige!\n";
    printf("String length is: %d\n", StrLen(src));

    return 0;
}
```

### 编译运行

下面的命令将俩个源文件中的程序编译成一个执行文件，文件名为 `test`。

```bash
$ gcc -o test strung.c main.c
```

执行编译出来的可执行文件 `test`，程序的运行结果如下：

```bash
$ ./test
String length is: 18
```

当然也可以先将源文件编成目标文件，然后进行链接。例如，下面的过程将 `string.c` 和 `main.c` 源文件编译成目标文件 `string.o` 和 `main.o`，然后将 `string.o` 和 `main.o` 链接生成 `test` ：

```bash
$ gcc -c string.c main.c
$ gcc -o test string.o main.o
```

### 预处理

在 C 语言程序中，通常需要包含头文件并会定义一些宏。 预处理过程将源文件中的头文件包含进源文件中，并且将文件中定义的宏进行扩展。

编译程序时选项 `-E` 告诉编译器进行预编译操作。例如如下命令将文件 `string.c` 的预处理结果显示在计算机屏幕上 :

```bash
$ gcc -E string.c
```

如果需要指定源文件编译后生成的中间结果文件名，需要使用选项 `-o`。例如，下面的代码将文件 `string.c` 进行预编译，生成文件 `string.i`。

```bash
$ gcc -o string.i -E string.c
```

## 编译成汇编语言

生成汇编语言的 GCC 选项 是 `-S`，默认情况下生成的文件名和源文件一致，扩展名为 `.s`。例如，下面的命令将 C 语言源文件 `string.c` 编译成汇编语言，文件名为 `string.s`。









